Guts of trait reform: Reimplement trait matching algorithm