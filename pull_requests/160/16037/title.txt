Add support for arms in macros and quotes, fix a pretty printer bug, and other minor features